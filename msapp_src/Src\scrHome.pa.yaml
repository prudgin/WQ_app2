# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  scrHome:
    Properties:
      Fill: =RGBA(255, 255, 255, 1)
      LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
      OnHidden: =false
      OnVisible: |-
        =Set(varUserEmail, Lower(User().Email));

        If(
            IsBlank(varMyFarm),
            Set(
                varUserPref,
                LookUp(
                    WQ_UserPreferences,
                    UserEmail = varUserEmail
                )
            );
            If(
                !IsBlank(varUserPref),
                Set(varMyFarm, varUserPref.MyFarm);
                Set(varRole, Coalesce(varUserPref.Role, "Worker"))
            )
        );
    Children:
      - conHomeRoot:
          Control: GroupContainer@1.0.0
          Properties:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =Parent.Height
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =24
            PaddingBottom: =24
            PaddingLeft: =24
            PaddingRight: =24
            PaddingTop: =24
            Width: =Parent.Width
            X: =0
            Y: =0
          Children:
            - conHomeLayout:
                Control: GroupContainer@1.0.0
                Properties:
                  Height: =Parent.Height
                  LayoutAlignItems: =LayoutAlignItems.Stretch
                  LayoutDirection: =If(Parent.Width < 700, LayoutDirection.Vertical, LayoutDirection.Horizontal)
                  LayoutGap: =24
                  Width: =Parent.Width
                Children:
                  - conHomeNav:
                      Control: GroupContainer@1.0.0
                      Properties:
                        Fill: =RGBA(248, 248, 248, 1)
                        Height: =If(Parent.Width < 700, 96, Parent.Height)
                        LayoutAlignItems: =LayoutAlignItems.Stretch
                        LayoutDirection: =If(Parent.Width < 700, LayoutDirection.Horizontal, LayoutDirection.Vertical)
                        LayoutGap: =16
                        PaddingBottom: =16
                        PaddingLeft: =16
                        PaddingRight: =16
                        PaddingTop: =16
                        Width: =If(Parent.Width < 700, Parent.Width, 220)
                      Children:
                        - ButtonCanvas3:
                            Control: Button@0.0.45
                            Properties:
                              FontSize: =20
                              Height: =48
                              OnSelect: |-
                                =Set(varEntryMode, "New");
                                Set(varEditReading, Defaults(WQ_Readings));
                                Navigate(scrNewReading, ScreenTransition.None);
                              Text: ="New Reading"
                              Width: =If(Parent.LayoutDirection = LayoutDirection.Horizontal, (Parent.Width - Parent.LayoutGap) / 2, Parent.Width)
                        - ButtonCanvas4:
                            Control: Button@0.0.45
                            Properties:
                              FontSize: =20
                              Height: =48
                              OnSelect: =Navigate(scrReview)
                              Text: ="Review"
                              Width: =If(Parent.LayoutDirection = LayoutDirection.Horizontal, (Parent.Width - Parent.LayoutGap) / 2, Parent.Width)
                  - conHomeMain:
                      Control: GroupContainer@1.0.0
                      Properties:
                        Height: =Parent.Height
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        Width: =Parent.Width
                      Children:
                        - conHomeCard:
                            Control: GroupContainer@1.0.0
                            Properties:
                              BorderColor: =RGBA(230, 230, 230, 1)
                              BorderThickness: =1
                              Fill: =RGBA(255, 255, 255, 1)
                              LayoutAlignItems: =LayoutAlignItems.Stretch
                              LayoutDirection: =LayoutDirection.Vertical
                              LayoutGap: =12
                              PaddingBottom: =24
                              PaddingLeft: =24
                              PaddingRight: =24
                              PaddingTop: =24
                              Width: =Min(Parent.Width, 520)
                            Children:
                              - Label1_1:
                                  Control: Label@2.5.1
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    Size: =24
                                    Text: ="Selected farm: " & Coalesce(varMyFarm, "(not set)")
                                    Width: =Parent.Width
                              - TextCanvas1_1:
                                  Control: Text@0.0.51
                                  Properties:
                                    Height: =32
                                    Size: =16
                                    Text: ="Please select your farm"
                                    Width: =Parent.Width
                              - ddMyFarm_1:
                                  Control: Classic/DropDown@2.3.1
                                  Properties:
                                    BorderColor: =RGBA(245, 245, 245, 1)
                                    ChevronBackground: =RGBA(245, 245, 245, 1)
                                    ChevronDisabledBackground: =RGBA(242, 242, 241, 0)
                                    ChevronDisabledFill: =RGBA(161, 159, 157, 1)
                                    ChevronFill: =RGBA(50, 49, 48, 1)
                                    ChevronHoverBackground: =RGBA(245, 245, 245, 1)
                                    ChevronHoverFill: =RGBA(50, 49, 48, 1)
                                    Color: =RGBA(50, 49, 48, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(161, 159, 157, 1)
                                    DisabledFill: =RGBA(242, 242, 241, 0)
                                    Fill: =RGBA(245, 245, 245, 1)
                                    Font: =Font.'Segoe UI'
                                    HoverBorderColor: =RGBA(16, 110, 190, 1)
                                    HoverColor: =RGBA(50, 49, 48, 1)
                                    HoverFill: =RGBA(245, 245, 245, 1)
                                    Items: =Sort(WQ_Farms, Farm, SortOrder.Ascending)
                                    Items.Value: =field_1
                                    OnChange: =
                                    PaddingBottom: =5
                                    PaddingLeft: =12
                                    PaddingRight: =5
                                    PaddingTop: =5
                                    PressedBorderColor: =RGBA(16, 110, 190, 1)
                                    PressedColor: =RGBA(255, 255, 255, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    SelectionColor: =RGBA(50, 49, 48, 1)
                                    SelectionFill: =RGBA(0, 120, 212, 1)
                                    Width: =Parent.Width
                              - ButtonCanvas1_1:
                                  Control: Button@0.0.45
                                  Properties:
                                    FontSize: =20
                                    Height: =48
                                    OnSelect: |-
                                      =Patch(
                                          WQ_UserPreferences,
                                          Coalesce(
                                              LookUp(WQ_UserPreferences, UserEmail = varUserEmail),
                                              Defaults(WQ_UserPreferences)
                                          ),
                                          {
                                              Title: varUserEmail,
                                              UserEmail: varUserEmail,
                                              MyFarm: ddMyFarm_1.Selected.Farm,
                                              Role: "Worker"
                                          }
                                      );

                                      Set(varMyFarm, ddMyFarm_1.Selected.Farm);
                                    Text: ="Save farm selection"
                                    Width: =Parent.Width
            - ButtonCanvas4_2:
                Control: Button@0.0.45
                Properties:
                  Height: =42
                  Visible: =false
                  Width: =162
